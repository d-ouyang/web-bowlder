<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>掌玉宝|首页</title>
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <link rel="stylesheet" href="../layui/css/layui.css">
  <link rel="stylesheet" href="../common/style/base.css">
  <link rel="stylesheet" href="../common/style/header.css">
  <link rel="stylesheet" href="../common/style/nav.css?id=1">
  <link rel="stylesheet" href="../common/style/footer.css">
</head>
<style>
  .index-bg {
    position: fixed;
    min-width: 1440px;
    width: 100%;
    height: 580px;
    top: 128px;
    left: 50%;
    transform: translateX(-50%);
    -webkit-transform: translateX(-50%);
    -moz-transform: translateX(-50%);
    -o-transform: translateX(-50%);
  }

  .main-home {
    position: relative;
    padding-top: 128px;
  }

  .home-header {
    position: relative;
    height: 580px;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 160px 375px 0;
    z-index: 5;
  }

  .home-header_title {
    font-size: 42px;
    color: #fff;
    letter-spacing: 1px;
    font-weight: bold;
    text-shadow: 0 0 10px #ccc;
    margin-bottom: 60px;
  }

  .home-header_btn {
    position: relative;
    display: flex;
    flex-direction: row;
    align-items: center;
    margin-bottom: 73px;
  }

  .home-header_btn button {
    width: 229px;
    height: 60px;
    line-height: 60px;
    color: #fff;
    border-radius: 6px;
    background-color: #000;
  }

  .home-header_btn .bowlder-add_btn {
    margin-left: 32px;
  }

  .home-search-box {
    position: relative;
    width: 100%;
    max-width: 690px;
    height: 54px;
    border-radius: 4px;
    padding: 0 16px;
    background-color: #fff;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }

  .home-search-box input {
    border: 0;
    outline: none;
    width: 80%;
    font-size: 14px;
    color: #2F2F33;
  }

  .home-history-search {
    position: absolute;
    width: 100%;
    max-width: 690px;
    top: 472px;
    border-radius: 4px;
    background-color: #fff;
    box-shadow:0px 4px 9px 0px rgba(0,0,0,0.1);
    -webkit-box-shadow: 0px 4px 9px 0px rgba(0,0,0,0.1);
    -moz-box-shadow: 0px 4px 9px 0px rgba(0,0,0,0.1);
    -o-box-shadow: 0px 4px 9px 0px rgba(0,0,0,0.1);
  }

  .history-search {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    height: 32px;
  }

  .history-search span {
    font-size: 12px;
    color: #9B9B9B;
  }

  .history-item {
    height: 36px;
    font-size: 14px;
    line-height: 36px;
    color: #2F2F33;
    padding: 0 16px;
    cursor: pointer;
  }
  .no-history{
    height: 36px;
    color: #9B9B9B;
    font-size: 14px;
    line-height: 36px;
    text-align: center;
  }
  .history-item:hover {
    background-color: #F2F2F2;
  }

  .home-body{
    position: relative;
    min-height: 500px;
    background-color: #fff;
  }
  .home-body-kinds{
    position: relative;
    padding: 70px 400px 0;
    display: flex;
    flex-direction: row;
    justify-content: space-around;
    margin-bottom: 70px;
  }
  .kind-item{
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
  }
  .item-img{
    margin-bottom: 10px;
  }
  .item-img img{
    width: 84px;
    height: 84px;
  }
  .item-title{
    font-size: 14px;
    color: #2F2F33;
    font-weight: bold;
    margin-bottom: 3px;
  }
  .item-English{
    font-size: 10px;
    color: #2F2F33;
  }
  .home-examples{
    padding: 0 125px 70px;
  }
  .examples-wrapper{
    width: 100%;
    max-width: 1190px;
    margin-left: 50%;
    transform: translateX(-50%);
    -webkit-transform: translateX(-50%);
    -moz-transform: translateX(-50%);
    -o-transform: translateX(-50%);
  }
  .example {
    float: left;
    width: 290px;
    height: 280px;
    border: 1px solid #EFEFEF;
    margin-right: 10px;
    margin-bottom: 10px;
  }
  .example-s{
    width: 590px;
  }
  .example img{
    width: 100%;
    height: 100%;
  }
  .home-body-newest{
    position: relative;
    background-color: #F9F9FA;
  }
  .home-newest-header{
    position: relative;
    min-width: 1440px;
    width: 100%;
    height: 250px;
    margin-bottom: 25px;
  }
  .home-newest-header{
    text-align: center;
    padding-top: 88px;
  }
  .home-newest-header img{
    position: absolute;
    left: 0;
    top: 0;
    min-width: 1440px;
    width: 100%;
    height: 250px;
  }
  .home-newest-header h3{
    color: #fff;
    font-size: 32px;
    font-weight: bold;
    margin-bottom: 2px;
  }
  .home-newest-header p{
    color: #fff;
    font-size: 20px;
    font-weight: bold;
    letter-spacing: 2px;
  }
  .home-newest-list-wrapper{
    padding: 40px 125px 70px;
  }
  .list-box{
    width: 100%;
    max-width: 1190px;
    margin-left: 50%;
    transform: translateX(-50%);
    -webkit-transform: translateX(-50%);
    -moz-transform: translateX(-50%);
    -o-transform: translateX(-50%);
    margin-bottom: 16px;
  }

  .no-data {
    width: 100%;
    font-size: 32px;
    color:#9B9B9B;
    text-align: center;
    line-height: 64px;
  }
  .no-data-btn-wrap{
    width: 100%;
    text-align: center;
    margin-top: 30px;
  }
  .no-data-btn {
    width: 230px;
    height: 60px;
    line-height: 60px;
    color: #fff;
    border-radius: 6px;
    background-color: #000;
  }

  .new-item{
    float: left;
    margin-right: 23px;
    margin-bottom: 24px;
    width: 280px;
    border-radius: 5px;
    background-color: #fff;
  }
  .new-item:nth-of-type(4n){
    margin-right: 0;
  }
  .new-item img{
    width: 280px;
    height: 280px;
    vertical-align: middle;
  }
  .info-box{
    width: 100%;
    border-top:1px solid #EFEFEF;
    height: 65px;
    padding: 14px 17px;
    color: #2F2F33;
    font-size: 14px;
    font-weight: bold;
    line-height: 1;
  }
  .code{
    margin-bottom: 9px;
  }

  .laypage-box{
    width: 1190px;
    height: 60px;
    background-color: #fff;
    border-radius: 5px;
    margin-left: 50%;
    transform: translateX(-50%);
    -webkit-transform: translateX(-50%);
    -moz-transform: translateX(-50%);
    -o-transform: translateX(-50%);
  }

  .layui-laypage-box{
    width: 100%;
    height: 60px;
    margin: 0;
    padding-top: 15px;
    text-align: center;
  }
  .layui-laypage-box a,.layui-laypage-box span {
    width: 34px;
    height: 34px;
    padding: 0;
    margin: 0;
    border: 0;
    font-size: 13px;
    margin-right: 10px;
  }
  .layui-laypage-box .layui-laypage-curr .layui-laypage-em{
    background-color: #F7F7F7;
    border-radius: 50%;
    left: 0;
    top: -3px;
    padding: 0;
  }
  .layui-laypage .layui-laypage-curr em{
    color: #838D8F;
  }

</style>
<body>
<section class="layui-main">
  <!--header -->
  <section class="header box-sizing">
    <div class="title">
      <!--<image class="logo" src=""></image>-->
      <div class="layui-inline title-one">掌玉宝</div>
      <div class="layui-inline title-two">交易平台</div>
    </div>
    <div class="header-right layui-hide-sm layui-show-md-block layui-show-lg-block">
      <div class="search-box">
        <i class="layui-icon cancle-icon layui-hide" id="header-cancle">&#x1006;</i>
        <input type="text" id="header-search-input" class="layui-inline search-input layui-hide" placeholder="搜索商品编号或者分类名称">
        <i class="layui-icon search-icon" id="header-search">&#xe615;</i>
      </div>

      <div class="my-count">
        <div class="count" id="count">我的账户</div>
        <div class="exit-box" id="exit" style="display: none;">
          <div class="exit">退出</div>
          <div class="triangle"></div>
        </div>
      </div>

      <div class="lan">
        <div class="layui-inline lan-active " id="Chinese">中文</div>
        <div class="layui-inline lan-active"> /</div>
        <div class="layui-inline" id="English">English</div>
      </div>
    </div>
  </section>

  <!--navbar-->
  <section class="nav">
    <ul class="nav-box">
      <li class="nav-item nav-active" data-page="index">
        首页
      </li>
      <li class="nav-item" data-page="list">
        玉石列表
      </li>
      <li class="nav-item" data-page="add">
        添加玉石
      </li>
    </ul>
  </section>

  <!--bg-img-->
  <section>
    <img class="index-bg" lay-src="../common/images/index-bg.png">
  </section>
  <!--body-->
  <section class="main-content">
    <div class="main-home">
      <div class="home-header box-sizing">
        <div class="home-header_title">来自缅甸的优质玉石</div>
        <div class="home-header_btn">
          <button class="layui-btn bowlder-list_btn">玉石列表</button>
          <button class="layui-btn bowlder-add_btn">
            <i class="layui-icon">&#xe654;</i> 上传玉石
          </button>
        </div>
        <div class="home-search-box box-sizing">
          <input id="home-input" type="text" placeholder="搜索商品编号或者分类名称">
          <i class="layui-icon" style="font-size: 25px;cursor: pointer">&#xe615;</i>
        </div>
        <div class="home-history-search box-sizing layui-hide" id="history_list">
          <script id="history" type="text/html">

            <div class="history-search box-sizing">
              <span>{{d.title}}</span>
            </div>
            <ul class="history-search-list">
              {{# layui.each(d.list, function (index, item) { }}
                <li class="history-item box-sizing">{{item}}</li>
              {{# }) }}
              {{#  if(d.list.length === 0){ }}
                <p class="no-history">暂无搜索数据</p>
              {{#  } }}
            </ul>
          </script>
        </div>
      </div>
      <div class="home-body">
        <div class="home-body-kinds box-sizing">
          <div class="kind-item">
            <div class="item-img">
              <img lay-src="../common/images/stone@3x.png" alt="">
            </div>
            <div class="item-title">
              原石
            </div>
            <div class="item-English">
              Original stone
            </div>
          </div>
          <div class="kind-item">
            <div class="item-img">
              <img lay-src="../common/images/cropping@3x.png" alt="">
            </div>
            <div class="item-title">
              切料
            </div>
            <div class="item-English">
              More than expected
            </div>
          </div>
          <div class="kind-item">
            <div class="item-img">
              <img lay-src="../common/images/product@3x.png" alt="">
            </div>
            <div class="item-title">
              成品
            </div>
            <div class="item-English">
              end product
            </div>
          </div>
        </div>
        <div class="home-examples box-sizing">
          <div class="examples-wrapper layui-clear">
            <div class="example box-sizing">
              <img lay-src="../common/images/earring-1.png">
            </div>
            <div class="example example-s box-sizing">
              <img src="../common/images/jewellery.png">
            </div>
            <div class="example box-sizing" style="margin-right: 0">
              <img lay-src="../common/images/earring-1.png">
            </div>
            <div class="example box-sizing">
              <img lay-src="../common/images/earring-1.png">
            </div>
            <div class="example box-sizing">
              <img lay-src="../common/images/earring-1.png">
            </div>
            <div class="example example-s box-sizing" style="margin-right: 0">
              <img lay-src="../common/images/jewellery.png">
            </div>
          </div>
        </div>
        <div class="home-body-newest">
          <div class="home-newest-header box-sizing">
            <img lay-src="../common/images/new-list-bg@2x.png">
            <h3>最新添加</h3>
            <p>Newest addition</p>
          </div>
          <div class="home-newest-list-wrapper box-sizing">
            <ul class="list-box layui-clear" id="list-box">
              <script id="new-list" type="text/html">

                {{# layui.each(d, function (index, item) { }}
                <li class="new-item" data-type="{{item.type}}" data-number="{{item.serialNumber}}">
                  <img lay-src="{{item.src}}">
                  <div class="info-box box-sizing">
                      <div class="code">编号：{{item.serialNumber}}</div>
                    {{# if(item.type == 1){ }}
                      <div class="tag">分类：原石</div>
                    {{# } else if (item.type == 2) {}}
                      <div class="tag">分类：切料</div>
                    {{# } else if (item.type == 3) {}}
                      <div class="tag">分类：成品</div>
                    {{# } }}
                  </div>
                </li>
                {{# }) }}
                {{# if (d.length === 0) { }}
                  <p class="no-data">还没有任何新增记录</p>
                  <div class="no-data-btn-wrap">
                    <button class="layui-btn no-data-btn">
                      <i class="layui-icon">&#xe654;</i> 上传玉石
                    </button>
                  </div>
                {{# } }}
              </script>
            </ul>
            <div class="laypage-box box-sizing">
              <div id="laypage"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!--footer-->
  <section class="footer">
    <div class="layui-row">
      <div class="footer-box layui-col-lg6 layui-col-md6 layui-col-sm6 layui-col-xs6 box-sizing">
        <h3 class="footer-title">掌玉宝</h3>
        <div class="footer-desc layui-row">
          <div class="layui-col-lg6 layui-col-md6 layui-col-sm6 layui-col-xs6">
            掌玉宝 是一个提供原石、切割后毛料、成品场外交易的平台，我们致力于让玉石更加全面、更详细的展现在平台。
          </div>
        </div>
      </div>
      <div class="footer-box layui-col-lg6 layui-col-md6 layui-col-sm6 layui-col-xs6 box-sizing">
        <h3 class="footer-title">联系</h3>
        <div class="footer-desc layui-row">
          <div class="layui-col-lg6 layui-col-md6 layui-col-sm6 layui-col-xs6">
            <div class="footer-info">电话：13622334451</div>
            <div class="footer-info">邮箱：mapleparking@talking.com</div>
          </div>
          <div class="layui-col-lg6 layui-col-md6 layui-col-sm6 layui-col-xs6">
            <div class="footer-info">网址：www.mapleparking.com</div>
            <div class="footer-info">地址：广东省佛山市XXXX号缅甸玉石交易中心</div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-icp">
      沪ICP备 16019295号 版权所有 ©mapleparking.com
    </div>
  </section>
</section>
</body>
<script type="text/javascript" src="../layui/layui.js"></script>
<script type="text/javascript" src="../libs/plugin.js?id=20"></script>
<script type="text/javascript">
  $(function () {
    layui.use(['layer', 'form', 'laytpl', 'flow', 'laypage'], function () {
      var layer = layui.layer,
        form = layui.form,
        flow = layui.flow,
        laypage= layui.laypage,
        laytpl = layui.laytpl;

      var CURRENT_PAGE = 'index';

      const ERR_OK = 0;
      const IMAGE_BASE = 'http://47.52.105.7/';

      var fromPage, isLog, baseUrl, token, history_data;

      var init = function () {
        fromPage = getParamValue('from') || 'index';
        token = layui.data('login_info').access_token;
        isLog = returnLoginState(token);
        baseUrl = returnBaseUrl();
        history_data = layui.data('history').history_data;
        if (!history_data) {
          history_data = {
            "title": "最近搜索",
            "list" : []
          }
          layui.data('history', {
            key: 'history_data',
            value: history_data
          })
        }
      }

      init();

      var headerModule = (function (h) {
        var $count = h.$count = $('#count');
        var $exit = h.$exit = $('#exit');
        var $headerSearch = h.$headerSearch = $('#header-search');
        var $headerCancle = h.$headerCancle = $('#header-cancle');
        var $headerSearchInput = h.$headerSearchInput = $('#header-search-input');

        $exit.hide();

        h.init = function () {
          if (!isLog) {
            $count.html('登录');
            window.location.href = './login.html?from=' + CURRENT_PAGE;
            return;
          } else {
            $count.html('我的账户');
          }
        }

        $count.on('click', function () {
          if (isLog) {
            $exit.toggle();
          } else {
            window.location.href = './login.html?from=' + CURRENT_PAGE;
          }
        })

        $exit.on('click', function () {
          layui.data('login_info',null);
          window.location.href = './login.html?from=' + CURRENT_PAGE;
        })

        $headerSearch.on('mousedown', function() {
          var currentValue = $headerSearchInput.val();
          if (currentValue != '') {
            history_data = layui.data('history').history_data;
            resetHistoryData(history_data, currentValue);
            $headerSearchInput.val('');
            window.location.href = './results.html?from=' + CURRENT_PAGE + '&key=' + currentValue;
          }
          $(this).parent('.search-box').width(285);
          $(this).siblings('input,i').removeClass('layui-hide');
          $(this).css('left','255px');
          $('.my-count, .lan').addClass('layui-hide');
        })

        $headerCancle.on('click', function() {
          $(this).parent('.search-box').width(0);
          $(this).addClass('layui-hide').siblings('input').addClass('layui-hide');
          $headerSearch.css('left','0');
          $headerSearchInput.val('');
          $('.my-count, .lan').removeClass('layui-hide');
        })

        $headerSearchInput.on('focus',function() {
          $(this).attr('placeholder', '');
        }).on('keyup', function(e) {
          var e = e || window.event;
          if (e.keyCode === 13) {
            $(this).blur();
            var currentValue = $(this).val();
            if (currentValue == '') {
              return;
            }
            history_data = layui.data('history').history_data;
            resetHistoryData(history_data, currentValue);
            console.log(layui.data('history').history_data);
            $(this).val('');
            $(this).attr('placeholder','搜索商品编号或者分类名称');
            window.location.href = './results.html?from=' + CURRENT_PAGE + '&key=' + currentValue;
          }
        }).on('blur', function(e) {
          $(this).attr('placeholder', '搜索商品编号或者分类名称');
        })

        h.init();

        return h;
      })(window.headerModule || {});

      var navModule = (function (n) {
        $('.nav-item').on('click', function () {
          if ($(this).hasClass('nav-active')) {
            return;
          }
          var gotoPage = $(this).attr('data-page');
          window.location.href = './'+ gotoPage + '.html';
        })
        return n;
      })(window.navModule || {});

      var homeModule = (function (h) {
        h.currentPage = 1;
        var LIMIT = 16;
        token = layui.data('login_info').access_token;
        // 历史记录模板
        var $historyList = $('#history_list');
        var getTpl = $('#history').html();
        //请求列表模板
        var $listBox = $('#list-box');
        var gethtml = $('#new-list').html();

        var currentPageData = [];

        //渲染历史记录模板
        function renderModel(getTpl, data, el, cb) {
          laytpl(getTpl).render(data, function(html) {
            el.html(html);
            typeof cb == 'function' && cb();
          })
        }

        //返回请求的 url
        function returnUrl (page, limit) {
          return baseUrl + 'jades' + '?page=' + page + '&limit=' + limit;
        }

        // 处理请求数据
        function handleData (data) {
          console.log(data);
          if (data.code === ERR_OK) {
            console.log(h.currentPage);
            if (h.currentPage == 1) {
              renderLaypage(data.data.totalElements, h.currentPage);
            }
            currentPageData = data.data.content;
            for (var i in currentPageData) {
              if (currentPageData[i].image.indexOf('https') > -1) {
                currentPageData[i].src = currentPageData[i].image;
              } else {
                currentPageData[i].src = IMAGE_BASE + currentPageData[i].image.split(',')[0];
              }
            }
            console.log(currentPageData);
            renderModel(gethtml, currentPageData, $listBox, function() {
              $('.new-item').on('click', function() {
                console.log($(this));
                var type = $(this).attr('data-type');
                var serialNumber = $(this).attr('data-number');
                window.location.href = './detail.html?from=' + CURRENT_PAGE + '&type=' + type + '&number=' + serialNumber;
              })
            })
          } else {
            layer.msg(res.msg);
          }
        }

        // 渲染分页
        function renderLaypage(count, currentPage) {
          laypage.render({
            elem: 'laypage',
            count: count,
            limit: 16,
            curr: currentPage,
            groups: 5,
            prev: '<i class="layui-icon">&#xe603;</i>',
            next: '<i class="layui-icon">&#xe602;</i>',
            theme: 'box',
            jump: function(obj,first){
              //首次不执行
              if(!first){
                console.log(obj.curr); //得到当前页，以便向服务端请求对应页的数据。
                console.log(obj.limit); //得到每页显示的条数
                h.currentPage = obj.curr;
                var requestUrl = returnUrl(h.currentPage, obj.limit);
                requestGet(requestUrl, token, handleData);
              }
            }
          })
        }

        laytpl(gethtml).render(currentPageData, function(html) {
          $listBox.html(html);
        })

        h.init = function () {
          flow.lazyimg();
          // 注册 btn 点击跳转
          $('.bowlder-list_btn').on('click', function () {
            window.location.href = './list.html';
          });
          $('.bowlder-add_btn, .no-data-btn').on('click', function () {
            window.open('./add.html');
          })

          //注册点击 原石、切料、成品 事件
          $('.kind-item').on('click', function () {
            var tarIndex = $(this).index();
            window.location.href = './results.html?from=' + CURRENT_PAGE + '&type=' + (tarIndex+1);
          })

          // 搜索
          $('#home-input').on('focus',function() {
            var that = this;
            history_data = layui.data('history').history_data;
            console.log(history_data);
            $(this).attr('placeholder','');
            $('.home-history-search').removeClass('layui-hide');
            renderModel(getTpl, history_data, $historyList, function () {
              $('.history-search-list').on('mousedown', function (e) {
                var e = e || window.event;
                var target = e.target || e.srcElement;
                if (target.nodeName.toLowerCase() == 'li') {
                  var _text = $(target).text();
                  var _index = $(target).index();
                  $(that).val(_text);
                  $('.home-history-search').addClass('layui-hide');
                  resetHistoryData(history_data, _text, _index);
                  console.log(layui.data('history').history_data);
                  window.location.href = './results.html?from=' + CURRENT_PAGE + '&key=' + _text;
                }
              });
            });
          }).on('keyup', function(e) {
            var e = e || window.event;
            if(e.keyCode === 13) {
              $(this).blur();
              var currentValue = $(this).val();
              if (currentValue == '') {
                return;
              }
              history_data = layui.data('history').history_data;
              resetHistoryData(history_data, currentValue);
              console.log(layui.data('history').history_data);
              $(this).val('');
              $(this).attr('placeholder','搜索商品编号或者分类名称');
              window.location.href = './results.html?from=' + CURRENT_PAGE + '&key=' + currentValue;
            }
          }).on('blur',function(e) {
            var e = e || window.event;
            $(this).attr('placeholder','搜索商品编号或者分类名称');
            $('.home-history-search').addClass('layui-hide');
          })

          $('#home-input').next('i').on('click',function(){
            var currentValue = $(this).prev().val();
            console.log(currentValue);
            if (currentValue == '') {
              return;
            }
            history_data = layui.data('history').history_data;
            resetHistoryData(history_data, currentValue);
            console.log(layui.data('history').history_data);
            window.location.href = './results.html?from=' + CURRENT_PAGE + '&key=' + currentValue;
          })

          // 请求数据
          var requestUrl = returnUrl(h.currentPage, LIMIT);

          requestGet(requestUrl, token, handleData);

        }

        h.init();

        return h;
      })(window.homeModule || {});

      headerModule = navModule = homeModule = null;

    });
  })

</script>
</html>